% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/13_write_experiment_results.R
\name{write_experiment_results}
\alias{write_experiment_results}
\title{Write chromcall experiment results to file}
\usage{
write_experiment_results(x, experiment_name, file, alpha = 1e-05)
}
\arguments{
\item{x}{A chromcall sample \code{\link{RangedSummarizedExperiment}} object (after \code{\link[=test_region_counts]{test_region_counts()}}).}

\item{experiment_name}{A single experiment name to extract (must match \code{colnames(x)}).}

\item{file}{The output file path (tab-delimited \code{.tsv}).}

\item{alpha}{Significance threshold for adjusted p-values (default: 1e-5).}
}
\value{
A \code{\link{data.frame}} of region-level results (also written to file invisibly).
}
\description{
Extracts region-level results for a specific experiment from a chromcall sample
(a \code{\link{RangedSummarizedExperiment}} object generated by \code{\link[=test_region_counts]{test_region_counts()}})
and writes them to a tab-delimited file. This includes raw counts, test statistics,
log2 fold changes (if a control is present), and significance classification.

In no-control mode (e.g., ATAC-seq), \code{counts_control} and \code{logFC} are returned as \code{NA}.
}
\examples{
# Load example files from package
genome_file <- system.file("extdata", "genome.txt", package = "chromcall")
region_file <- system.file("extdata", "example.bed", package = "chromcall")
blacklist_file <- system.file("extdata", "blacklist.bed", package = "chromcall")
expression_file <- system.file("extdata", "expression_tss.bed", package = "chromcall")

# Example BAM files
bam_dir <- system.file("extdata", package = "chromcall")
experiments <- list(
  H3K27me3 = file.path(bam_dir, "h3k27me3_sampleA.bam"),
  H3K4me3  = file.path(bam_dir, "h3k4me3_sampleA.bam"),
  Control  = file.path(bam_dir, "control_sampleA.bam")
)

# Build sample and run region-level test
sample <- build_chromcall_sample(
  sample_name     = "sampleA",
  experiments     = experiments,
  control_name    = "Control",
  genome_file     = genome_file,
  region_file     = region_file,
  window_size     = 10000,
  blacklist_file  = blacklist_file,
  expression_file = expression_file
)
result <- test_region_counts(sample)

# Write H3K4me3 results to file (includes expression column if present)
out_file <- tempfile(fileext = ".tsv")
write_experiment_results(result, "H3K4me3", out_file)
read.table(out_file, header = TRUE)

## No-control mode example (ATAC-seq-style)
# Note: we use a package example BAM here for demonstration only.
atac <- build_chromcall_sample(
  sample_name     = "ATAC_A",
  experiments     = list(
    ATAC = system.file("extdata", "h3k27me3_sampleA.bam", package = "chromcall")
  ),
  control_name    = NULL,
  genome_file     = genome_file,
  region_file     = region_file,
  window_size     = 10000,
  blacklist_file  = blacklist_file,
  expression_file = expression_file
)
atac_res <- test_region_counts(atac)

out_file2 <- tempfile(fileext = ".tsv")
df_atac <- write_experiment_results(atac_res, "ATAC", out_file2)

# Inspect exported table (no-control)
head(df_atac[, c("counts_control", "counts_experiment", "logFC", "score")])
# In no-control mode, counts_control and logFC are NA
unique(df_atac$counts_control)
unique(df_atac$logFC)

}
