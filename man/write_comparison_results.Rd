% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/14_write_comparison_results.R
\name{write_comparison_results}
\alias{write_comparison_results}
\title{Write chromcall 2-sample comparison results to file}
\usage{
write_comparison_results(x, file)
}
\arguments{
\item{x}{A \code{\link{GRanges}} object generated by \code{\link[=compare_samples]{compare_samples()}}.}

\item{file}{Output file path (should end in \code{.tsv}).}
}
\value{
A \code{data.frame} invisibly, also written to \code{file}.
}
\description{
Converts the result of \code{\link[=compare_samples]{compare_samples()}} — a \code{\link{GRanges}} object containing
differential region-level statistics — into a \code{data.frame} and writes it to a
tab-delimited \code{.tsv} file. The \code{strand} column is removed (if present), and
the chromosome column is renamed to "chr" for consistency.

The function also attempts to order columns in a readable way:
genomic coordinates → sample1 expression + metrics → sample2 expression + metrics →
expression log2FC (if present) → delta metrics → any remaining columns.
}
\examples{
## Control-mode (ChIP/CUT&RUN-style): compare two tested samples and export
genome_file <- system.file("extdata", "genome.txt", package = "chromcall")
region_file <- system.file("extdata", "example.bed", package = "chromcall")
blacklist_file <- system.file("extdata", "blacklist.bed", package = "chromcall")
expr_file <- system.file("extdata", "expression_tss.bed", package = "chromcall")

sampleA <- build_chromcall_sample(
  sample_name     = "sampleA",
  experiments     = list(
    H3K4me3  = system.file("extdata", "h3k4me3_sampleA.bam", package = "chromcall"),
    Control = system.file("extdata", "control_sampleA.bam", package = "chromcall")
  ),
  control_name    = "Control",
  genome_file     = genome_file,
  region_file     = region_file,
  window_size     = 10000,
  blacklist_file  = blacklist_file,
  expression_file = expr_file
)

sampleB <- build_chromcall_sample(
  sample_name     = "sampleB",
  experiments     = list(
    H3K4me3  = system.file("extdata", "h3k4me3_sampleB.bam", package = "chromcall"),
    Control = system.file("extdata", "control_sampleB.bam", package = "chromcall")
  ),
  control_name    = "Control",
  genome_file     = genome_file,
  region_file     = region_file,
  window_size     = 10000,
  blacklist_file  = blacklist_file,
  expression_file = expr_file
)

resA <- test_region_counts(sampleA)
resB <- test_region_counts(sampleB)
cmp <- compare_samples(resA, resB, experiments = "H3K4me3", threshold = 0.05)

out_file <- tempfile(fileext = ".tsv")
write_comparison_results(cmp, out_file)
read.table(out_file, header = TRUE)

## No-control mode (ATAC-seq-style): export still works
# Note: we use package example BAMs here for demonstration only.
atacA <- build_chromcall_sample(
  sample_name     = "ATAC_A",
  experiments     = list(
    ATAC = system.file("extdata", "h3k27me3_sampleA.bam", package = "chromcall")
  ),
  control_name    = NULL,
  genome_file     = genome_file,
  region_file     = region_file,
  window_size     = 10000,
  blacklist_file  = blacklist_file,
  expression_file = expr_file
)

atacB <- build_chromcall_sample(
  sample_name     = "ATAC_B",
  experiments     = list(
    ATAC = system.file("extdata", "h3k27me3_sampleB.bam", package = "chromcall")
  ),
  control_name    = NULL,
  genome_file     = genome_file,
  region_file     = region_file,
  window_size     = 10000,
  blacklist_file  = blacklist_file,
  expression_file = expr_file
)

atac_resA <- test_region_counts(atacA)
atac_resB <- test_region_counts(atacB)

# For interpretation, it is recommended that both samples are processed under the same mode
# (control vs no-control).
atac_cmp <- compare_samples(atac_resA, atac_resB, experiments = "ATAC", threshold = 0.05)

out_file2 <- tempfile(fileext = ".tsv")
write_comparison_results(atac_cmp, out_file2)
read.table(out_file2, header = TRUE)

}
