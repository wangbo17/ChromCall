% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/11_test_region_counts.R
\name{test_region_counts}
\alias{test_region_counts}
\title{Test region counts in a chromcall sample}
\usage{
test_region_counts(x, trim_blacklist = TRUE)
}
\arguments{
\item{x}{A \link{RangedSummarizedExperiment} object containing counts and metadata.}

\item{trim_blacklist}{Logical; if \code{TRUE}, removes rows where \code{blacklist == TRUE} before testing.}
}
\value{
A modified \link{RangedSummarizedExperiment} object with additional assays:
\code{logFC}, \code{lambda_t}, \code{p_value}, \code{p_adj}, \code{score}, \code{z_pois},
and a rowData column \code{modification_factor}.
}
\description{
Conduct Poisson-based statistical tests on read counts across genomic regions
in a chromcall \link{RangedSummarizedExperiment} object. Adds assays for logFC,
background lambda, p-values, adjusted p-values, enrichment score, and a
Poisson Z-score.

In control mode, region-specific background weighting is estimated from the control
track (\code{modification_factor}). In no-control mode, background weighting is set to 1
everywhere (i.e. no input-based correction).
}
\examples{
## With control (ChIP/CUT&RUN-style)
sample <- build_chromcall_sample(
  sample_name = "sampleA",
  experiments = list(
    H3K27me3 = system.file("extdata", "h3k27me3_sampleA.bam", package = "chromcall"),
    H3K4me3  = system.file("extdata", "h3k4me3_sampleA.bam", package = "chromcall"),
    Control  = system.file("extdata", "control_sampleA.bam", package = "chromcall")
  ),
  control_name    = "Control",
  genome_file     = system.file("extdata", "genome.txt", package = "chromcall"),
  region_file     = system.file("extdata", "example.bed", package = "chromcall"),
  window_size     = 10000,
  blacklist_file  = system.file("extdata", "blacklist.bed", package = "chromcall"),
  expression_file = system.file("extdata", "expression_tss.bed", package = "chromcall")
)

# Run region-level testing
result <- test_region_counts(sample)

# Explore outputs
result
SummarizedExperiment::assayNames(result)
SummarizedExperiment::colData(result)
head(SummarizedExperiment::assay(result, "counts"))
head(SummarizedExperiment::assay(result, "lambda_t"))
head(SummarizedExperiment::assay(result, "p_adj"))
head(SummarizedExperiment::assay(result, "score"))
head(SummarizedExperiment::assay(result, "z_pois"))
head(SummarizedExperiment::rowData(result)$modification_factor)
head(SummarizedExperiment::rowData(result)$expression)

## No-control mode (ATAC-seq-style)
# Note: we use a package example BAM here for demonstration only.
atac_sample <- build_chromcall_sample(
  sample_name     = "ATAC_A",
  experiments     = list(ATAC = system.file("extdata", "h3k27me3_sampleA.bam", package = "chromcall")),
  control_name    = NULL,
  genome_file     = system.file("extdata", "genome.txt", package = "chromcall"),
  region_file     = system.file("extdata", "example.bed", package = "chromcall"),
  window_size     = 10000,
  blacklist_file  = system.file("extdata", "blacklist.bed", package = "chromcall"),
  expression_file = system.file("extdata", "expression_tss.bed", package = "chromcall")
)

atac_res <- test_region_counts(atac_sample)

# Explore outputs (no-control)
atac_res
SummarizedExperiment::assayNames(atac_res)
SummarizedExperiment::colData(atac_res)
head(SummarizedExperiment::assay(atac_res, "counts"))
head(SummarizedExperiment::assay(atac_res, "lambda_t"))
head(SummarizedExperiment::assay(atac_res, "p_adj"))
head(SummarizedExperiment::assay(atac_res, "score"))
head(SummarizedExperiment::assay(atac_res, "z_pois"))

# Note: in no-control mode, logFC is NA because there is no matched control track.
head(SummarizedExperiment::assay(atac_res, "logFC"))

}
